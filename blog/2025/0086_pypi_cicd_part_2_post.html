<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Cheroliv - Développeur Formateur | Ingénierie Pédagogique</title>

        <script>
          // IIFE to avoid polluting global scope
          (function() {
            try {
              const theme = localStorage.getItem('preferred-theme');
              if (theme) {
                document.documentElement.setAttribute('data-bs-theme', theme);
              }
            } catch (e) {
              // Reading from localStorage can fail in private browsing mode on some browsers
              console.warn('Could not set theme from localStorage', e);
            }
          })();
        </script>

        <!-- Bootstrap 5.3 CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />

        <!-- Bootstrap Icons -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css" rel="stylesheet" />

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        <!-- intl-tel-input CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@25.10.1/build/css/intlTelInput.css">

        <!-- Custom CSS -->
        <link href="../../css/styles.css" rel="stylesheet" />

        <!-- highlight.js: theme will be managed dynamically by script.js -->
<link id="highlight-js-theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/default.min.css">

        <link href="../../css/asciidoctor.css" rel="stylesheet"/>



        <!-- Favicon -->
        <link rel="shortcut icon"
              href="../..//img/cheroliv_logo_icon.png"/>

        

        <!-- Meta tags pour SEO -->
        <meta name="description" content="Développeur formateur spécialisé en ingénierie pédagogique. Conception et développement de solutions e-learning innovantes."/>
        <meta name="keywords" content="développement, formation, e-learning, ingénierie pédagogique, JavaScript, Bootstrap"/>
        <meta name="author" content="Cheroliv"/>

    </head>
<body>
<div class="main-content-wrapper">
    <div>
            <!-- Navigation -->
            <nav class="navbar navbar-expand-lg fixed-top">
                <div class="container">
                    <a class="navbar-brand fw-bold" href="../../index.html#home">
                        <i class="bi bi-code-slash me-2"></i>
                        Cheroliv
                    </a>

                    <button class="navbar-toggler"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#navbarNav"
                            aria-controls="navbarNav"
                            aria-expanded="false"
                            aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav ms-auto align-items-start">
                            <li class="nav-item">
                                <a class="nav-link" href="../../index.html#home">Accueil</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../../index.html#about">À propos</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../../index.html#services">Services</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../../index.html#expertise">Expertise</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../../index.html#formations">Formations</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../../index.html#portfolio">Portfolio</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../../blog.html">Blog</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle"
                                   href="#"
                                   id="memosDropdown"
                                   role="button"
                                   data-bs-toggle="dropdown"
                                   aria-expanded="false">
                                    <i class="fa-duotone fa-memo"></i> Memos
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="memosDropdown">
                                    <li><a class="dropdown-item" href="../../slides/index.html"><i class="fa-brands fa-presentation"></i> slides</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2022/0052_memo_jvm_post.html"><i class="fa-brands fa-java"></i> jvm</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2022/0053_memo_kotlin_post.html"><i class="fa-brands fa-korvue"></i> kotlin</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2022/0047_memo_gradle_post.html"><i class="fa-solid fa-industry"></i> gradle</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2023/0060_memo_js_post.html"><i class="fa-brands fa-square-js"></i> javascript</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2023/0063_memo_ts_post.html"><i class="fa-brands fa-square-js"></i> typescript</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2023/0062_memo_css_post.html"><i class="fa-brands fa-css3-alt"></i> css</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2023/0061_memo_html_post.html"><i class="fa-brands fa-html5"></i> html</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2023/0066_memo_python_post.html"><i class="fa-brands fa-python"></i> python</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2020/0021_memo_git_post.html"><i class="fa-brands fa-git-alt"></i> git</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2021/0030_memo_linux_post.html"><i class="fa-brands fa-linux"></i> linux</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2022/0054_memo_cadrage_post.html"><i class="fa-solid fa-arrows-split-up-and-left"></i> cadrage</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2022/0031_memo_design_system_post.html"><i class="fa-solid fa-pencil"></i> design system</a></li>
                                    <li><a class="dropdown-item" href="../../blog/2020/0016_asciidoc_markdown_memo_post.html"><i class="fa-brands fa-markdown"></i> asciidoc/markdown</a></li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../../index.html#contact">Contact</a>
                            </li>
                        </ul>
                        <!-- Theme Switcher moved outside the ul for simpler flexbox calculation -->
                        <div class="nav-item dropdown theme-switcher-container ms-lg-3">
                            <button class="btn btn-outline-secondary dropdown-toggle theme-dropdown-btn"
                                    type="button"
                                    id="themeDropdown"
                                    data-bs-toggle="dropdown"
                                    aria-expanded="false"
                                    aria-label="Sélectionner le thème de l'interface">
                                <i class="bi bi-sun"></i>
                                <span id="current-theme" class="visually-hidden">Light</span>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="themeDropdown">
                                <li><button class="dropdown-item theme-option"
                                       type="button"
                                       data-theme="light">
                                    <i class="bi bi-sun me-2"></i>Light
                                </button></li>
                                <li><button class="dropdown-item theme-option" type="button" data-theme="dark">
                                    <i class="bi bi-moon me-2"></i>Dark
                                </button></li>
                                <li><button class="dropdown-item theme-option" type="button" data-theme="high-contrast">
                                    <i class="bi bi-circle-half me-2"></i>High Contrast
                                </button></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    <main class="container main-content-padding" id="main-content">
        <article>
            <header class="page-header mb-4">
                <h1 class="h2">Partie 2 : Industrialiser et sécuriser un pipeline CI/CD Python avancé</h1>
                <p class="lead">
                    <em>Publié le 18 July 2025</em>
                </p>
            </header>

            <div class="content"><div id="toc" class="toc">
<div id="toctitle">Sommaire</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_architecture_du_pipeline_cicd">2. Architecture du Pipeline CI/CD</a></li>
<li><a href="#_structure_du_projet">3. Structure du Projet</a></li>
<li><a href="#_configuration_du_package_avec_pyproject_toml">4. Configuration du Package avec pyproject.toml</a></li>
<li><a href="#_workflow_de_cicd_tests_et_qualité">5. Workflow de CI/CD - Tests et Qualité</a></li>
<li><a href="#_workflow_de_release_et_déploiement">6. Workflow de Release et Déploiement</a></li>
<li><a href="#_diagrammes_darchitecture">7. Diagrammes d&#8217;Architecture</a>
<ul class="sectlevel2">
<li><a href="#_diagramme_de_séquence_processus_de_release">7.1. Diagramme de Séquence - Processus de Release</a></li>
<li><a href="#_diagramme_détats_cycle_de_vie_du_package">7.2. Diagramme d&#8217;États - Cycle de Vie du Package</a></li>
<li><a href="#_diagramme_de_déploiement_infrastructure_cicd">7.3. Diagramme de Déploiement - Infrastructure CI/CD</a></li>
</ul>
</li>
<li><a href="#_objets_et_modèles_du_pipeline">8. Objets et Modèles du Pipeline</a>
<ul class="sectlevel2">
<li><a href="#_diagramme_de_classes_modèles_cicd">8.1. Diagramme de Classes - Modèles CI/CD</a></li>
</ul>
</li>
<li><a href="#_configuration_des_secrets">9. Configuration des Secrets</a>
<ul class="sectlevel2">
<li><a href="#_secrets_github_actions">9.1. Secrets GitHub Actions</a></li>
<li><a href="#_génération_des_tokens_pypi">9.2. Génération des Tokens PyPI</a></li>
</ul>
</li>
<li><a href="#_scripts_de_développement_local">10. Scripts de Développement Local</a>
<ul class="sectlevel2">
<li><a href="#_makefile">10.1. Makefile</a></li>
<li><a href="#_script_de_version">10.2. Script de Version</a></li>
</ul>
</li>
<li><a href="#_bonnes_pratiques_et_recommandations">11. Bonnes Pratiques et Recommandations</a>
<ul class="sectlevel2">
<li><a href="#_versioning_sémantique">11.1. Versioning Sémantique</a></li>
<li><a href="#_stratégie_de_branching">11.2. Stratégie de Branching</a></li>
<li><a href="#_tests_et_couverture">11.3. Tests et Couverture</a></li>
<li><a href="#_sécurité">11.4. Sécurité</a></li>
</ul>
</li>
<li><a href="#_monitoring_et_observabilité">12. Monitoring et Observabilité</a>
<ul class="sectlevel2">
<li><a href="#_métriques_de_pipeline">12.1. Métriques de Pipeline</a></li>
<li><a href="#_notifications">12.2. Notifications</a></li>
</ul>
</li>
<li><a href="#_conclusion">13. Conclusion</a></li>
<li><a href="#_ressources_complémentaires">14. Ressources Complémentaires</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<div class="title">Objectif :</div>
<p>Transformer un pipeline simple en pipeline industriel robuste, respectant les standards modernes du packaging et de l’ingénierie logicielle.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dans la première partie de cette série, nous avons construit un pipeline CI/CD simple mais efficace pour automatiser les tests et la publication d’un package Python sur PyPI.</p>
</div>
<div class="paragraph">
<p>Il est maintenant temps de professionnaliser ce pipeline.
Dans cette seconde partie, nous allons :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Migrer vers le standard moderne pyproject.toml,</p>
</li>
<li>
<p>Ajouter des outils de qualité et de sécurité (Black, Mypy, Bandit, Safety),</p>
</li>
<li>
<p>Mettre en place des tests multi-versions,</p>
</li>
<li>
<p>Intégrer un déploiement progressif via Test PyPI,</p>
</li>
<li>
<p>Automatiser le versioning et améliorer la surveillance du pipeline.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Préparez-vous à passer d’un pipeline fonctionnel à une infrastructure CI/CD professionnelle.</p>
</div>
<div class="paragraph">
<p>Déployer une application Python sur PyPI nécessite un pipeline CI/CD robuste qui automatise les tests, la construction et la publication des packages.
Cet article détaille la mise en place d&#8217;un pipeline complet utilisant GitHub Actions pour une application CLI Python, en s&#8217;appuyant sur les bonnes pratiques de l&#8217;écosystème Python moderne.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture_du_pipeline_cicd">2. Architecture du Pipeline CI/CD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le pipeline que nous allons construire suit une approche en plusieurs étapes :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diag-plantuml-md5-7c661f88b9476d6adca6ed0f09d1f513.png" alt="Diagram" width="989" height="803">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_structure_du_projet">3. Structure du Projet</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Une application CLI Python prête pour la distribution doit respecter une structure standardisée :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">playlist-downloader/
├── .github/
│   └── workflows/
│       ├── ci.yml
│       ├── release.yml
│       └── security.yml
├── src/
│   └── playlist_downloader/
│       ├── __init__.py
│       ├── cli.py
│       ├── core/
│       └── adapters/
├── tests/
│   ├── unit/
│   ├── integration/
│   └── conftest.py
├── docs/
├── pyproject.toml
├── requirements.txt
├── requirements-dev.txt
├── MANIFEST.in
├── README.md
├── LICENSE
└── CHANGELOG.md</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_du_package_avec_pyproject_toml">4. Configuration du Package avec pyproject.toml</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le fichier <code>pyproject.toml</code> est le standard moderne pour configurer les packages Python :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="toml">[build-system]
requires = ["setuptools&gt;=45", "wheel", "setuptools_scm&gt;=6.2"]
build-backend = "setuptools.build_meta"

[project]
name = "playlist-downloader"
authors = [
    {name = "Christophe Hérolivier", email = "cheroliv@example.com"},
]
description = "CLI tool for YouTube playlist management"
readme = "README.md"
requires-python = "&gt;=3.8"
keywords = ["youtube", "playlist", "cli", "downloader"]
license = {text = "MIT"}
classifiers = [
    "Development Status :: 4 - Beta",
    "Environment :: Console",
    "Intended Audience :: End Users/Desktop",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Topic :: Multimedia :: Sound/Audio",
    "Topic :: Utilities",
]
dependencies = [
    "typer&gt;=0.9.0",
    "yt-dlp&gt;=2023.7.6",
    "google-api-python-client&gt;=2.0.0",
    "google-auth-oauthlib&gt;=1.0.0",
    "pyyaml&gt;=6.0",
    "rich&gt;=13.0.0",
]
dynamic = ["version"]

[project.optional-dependencies]
dev = [
    "pytest&gt;=7.0.0",
    "pytest-cov&gt;=4.0.0",
    "pytest-mock&gt;=3.10.0",
    "black&gt;=23.0.0",
    "flake8&gt;=6.0.0",
    "mypy&gt;=1.0.0",
    "pre-commit&gt;=3.0.0",
    "tox&gt;=4.0.0",
]
test = [
    "pytest&gt;=7.0.0",
    "pytest-cov&gt;=4.0.0",
    "pytest-mock&gt;=3.10.0",
]

[project.urls]
Homepage = "https://github.com/cheroliv/playlist-downloader"
Documentation = "https://github.com/cheroliv/playlist-downloader#readme"
Repository = "https://github.com/cheroliv/playlist-downloader.git"
"Bug Tracker" = "https://github.com/cheroliv/playlist-downloader/issues"

[project.scripts]
playlist-downloader = "playlist_downloader.cli:main"

[tool.setuptools_scm]
write_to = "src/playlist_downloader/_version.py"

[tool.setuptools.packages.find]
where = ["src"]

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = [
    "--cov=src/playlist_downloader",
    "--cov-report=html",
    "--cov-report=term-missing",
    "--cov-fail-under=85",
]

[tool.black]
line-length = 88
target-version = ['py38']
include = '\.pyi?$'
extend-exclude = '''
/(
  \.eggs
  | \.git
  | \.hg
  | \.mypy_cache
  | \.tox
  | \.venv
  | _build
  | buck-out
  | build
  | dist
)/
'''

[tool.mypy]
python_version = "3.8"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
check_untyped_defs = true
disallow_untyped_decorators = true
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_no_return = true
warn_unreachable = true
strict_equality = true

[[tool.mypy.overrides]]
module = [
    "yt_dlp.*",
    "googleapiclient.*",
    "google_auth_oauthlib.*",
]
ignore_missing_imports = true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_workflow_de_cicd_tests_et_qualité">5. Workflow de CI/CD - Tests et Qualité</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le workflow principal (<code>ci.yml</code>) exécute les tests sur plusieurs versions de Python :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml">name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.8", "3.9", "3.10", "3.11"]

    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Cache dependencies
      uses: actions/cache@v3
      with:
        path: |
          ~/.cache/pip
          ~/.cache/pre-commit
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements*.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -e ".[dev]"

    - name: Lint with flake8
      run: |
        flake8 src tests --count --select=E9,F63,F7,F82 --show-source --statistics
        flake8 src tests --count --exit-zero --max-complexity=10 --max-line-length=88 --statistics

    - name: Check code formatting with Black
      run: black --check src tests

    - name: Type checking with mypy
      run: mypy src

    - name: Run tests with pytest
      run: |
        pytest tests/ -v --cov=src/playlist_downloader \
          --cov-report=xml --cov-report=term-missing

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      if: matrix.python-version == '3.11'
      with:
        file: ./coverage.xml
        flags: unittests
        name: codecov-umbrella

  security:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install bandit[toml] safety

    - name: Run security checks with bandit
      run: bandit -r src/ -f json -o bandit-report.json

    - name: Check dependencies with safety
      run: safety check --json --output safety-report.json

    - name: Upload security reports
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: security-reports
        path: |
          bandit-report.json
          safety-report.json

  build:
    needs: [test, security]
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    - name: Install build dependencies
      run: |
        python -m pip install --upgrade pip
        pip install build twine

    - name: Build package
      run: python -m build

    - name: Check package with twine
      run: twine check dist/*

    - name: Upload build artifacts
      uses: actions/upload-artifact@v3
      with:
        name: dist
        path: dist/</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_workflow_de_release_et_déploiement">6. Workflow de Release et Déploiement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le workflow de release (<code>release.yml</code>) gère la publication automatique sur PyPI :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml">name: Release

on:
  push:
    tags:
      - 'v*.*.*'
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        default: 'test'
        type: choice
        options:
        - test
        - production

env:
  PYTHON_VERSION: "3.11"

jobs:
  release:
    runs-on: ubuntu-latest
    environment:
      name: ${{ github.event.inputs.environment || (startsWith(github.ref, 'refs/tags/') &amp;&amp; 'production' || 'test') }}

    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install build twine

    - name: Build package
      run: python -m build

    - name: Check package
      run: twine check dist/*

    - name: Publish to Test PyPI
      if: github.event.inputs.environment == 'test' || (startsWith(github.ref, 'refs/tags/') &amp;&amp; contains(github.ref, 'rc'))
      env:
        TWINE_USERNAME: __token__
        TWINE_PASSWORD: ${{ secrets.TEST_PYPI_API_TOKEN }}
      run: |
        twine upload --repository testpypi dist/*

    - name: Publish to PyPI
      if: github.event.inputs.environment == 'production' || (startsWith(github.ref, 'refs/tags/') &amp;&amp; !contains(github.ref, 'rc'))
      env:
        TWINE_USERNAME: __token__
        TWINE_PASSWORD: ${{ secrets.PYPI_API_TOKEN }}
      run: |
        twine upload dist/*

    - name: Create GitHub Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ github.ref }}
        draft: false
        prerelease: ${{ contains(github.ref, 'rc') }}

  post-release:
    needs: release
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/')

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}

    - name: Test installation from PyPI
      run: |
        sleep 60  # Attendre la propagation sur PyPI
        pip install playlist-downloader
        playlist-downloader --version

    - name: Update documentation
      run: |
        # Script pour mettre à jour la documentation
        echo "Documentation updated for version ${GITHUB_REF#refs/tags/}"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_diagrammes_darchitecture">7. Diagrammes d&#8217;Architecture</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_diagramme_de_séquence_processus_de_release">7.1. Diagramme de Séquence - Processus de Release</h3>
<div class="imageblock">
<div class="content">
<img src="images/diag-plantuml-md5-8e5219ce8920793948bdafac8a3427ec.png" alt="Diagram" width="886" height="888">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_diagramme_détats_cycle_de_vie_du_package">7.2. Diagramme d&#8217;États - Cycle de Vie du Package</h3>
<div class="imageblock">
<div class="content">
<img src="images/diag-plantuml-md5-2d132096cb63b0042bccf620fc284f91.png" alt="Diagram" width="303" height="1588">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_diagramme_de_déploiement_infrastructure_cicd">7.3. Diagramme de Déploiement - Infrastructure CI/CD</h3>
<div class="imageblock">
<div class="content">
<img src="images/diag-plantuml-md5-590851667decb6042a455cb888cc4200.png" alt="Diagram" width="681" height="760">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_objets_et_modèles_du_pipeline">8. Objets et Modèles du Pipeline</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_diagramme_de_classes_modèles_cicd">8.1. Diagramme de Classes - Modèles CI/CD</h3>
<div class="imageblock">
<div class="content">
<img src="images/diag-plantuml-md5-510e3cb608857126a0dcae824abe3148.png" alt="Diagram" width="831" height="745">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_des_secrets">9. Configuration des Secrets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour que le pipeline fonctionne, vous devez configurer les secrets suivants dans GitHub :</p>
</div>
<div class="sect2">
<h3 id="_secrets_github_actions">9.1. Secrets GitHub Actions</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"># Dans Settings &gt; Secrets and variables &gt; Actions

# Token PyPI pour la production
PYPI_API_TOKEN=pypi-...

# Token Test PyPI pour les pré-releases
TEST_PYPI_API_TOKEN=pypi-...

# Token GitHub pour créer les releases
GITHUB_TOKEN=(automatiquement fourni)

# Token Codecov (optionnel)
CODECOV_TOKEN=...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_génération_des_tokens_pypi">9.2. Génération des Tokens PyPI</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"># 1. Créer un compte sur PyPI et Test PyPI
# 2. Aller dans Account Settings &gt; API tokens
# 3. Créer un token avec scope "Entire account" ou spécifique au projet
# 4. Format du token : pypi-AgEIcHlwaS5vcmc...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scripts_de_développement_local">10. Scripts de Développement Local</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour faciliter le développement, créez des scripts utilitaires :</p>
</div>
<div class="sect2">
<h3 id="_makefile">10.1. Makefile</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="makefile">.PHONY: install test lint format security build clean release-test release-prod

install:
	pip install -e ".[dev]"

test:
	pytest tests/ -v --cov=src/playlist_downloader

lint:
	flake8 src tests
	mypy src

format:
	black src tests

security:
	bandit -r src/
	safety check

build:
	python -m build
	twine check dist/*

clean:
	rm -rf build/ dist/ *.egg-info/
	find . -type d -name __pycache__ -delete
	find . -name "*.pyc" -delete

release-test: clean build
	twine upload --repository testpypi dist/*

release-prod: clean build
	twine upload dist/*

pre-commit: format lint test security
	@echo "✅ Prêt pour commit"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_script_de_version">10.2. Script de Version</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python">#!/usr/bin/env python3
"""Script pour gérer les versions du projet."""

import sys
import subprocess
from pathlib import Path

def get_current_version():
    """Récupère la version actuelle depuis git."""
    try:
        result = subprocess.run(
            ["git", "describe", "--tags", "--abbrev=0"],
            capture_output=True,
            text=True,
            check=True
        )
        return result.stdout.strip()
    except subprocess.CalledProcessError:
        return "0.0.0"

def create_version_tag(version, message=None):
    """Crée un tag de version."""
    if not version.startswith('v'):
        version = f'v{version}'

    tag_message = message or f"Release {version}"

    subprocess.run(["git", "tag", "-a", version, "-m", tag_message], check=True)
    print(f"✅ Tag {version} créé")

    # Push le tag
    subprocess.run(["git", "push", "origin", version], check=True)
    print(f"✅ Tag {version} poussé vers origin")

if __name__ == "__main__":
    if len(sys.argv) &lt; 2:
        current = get_current_version()
        print(f"Version actuelle: {current}")
        print("Usage: python version.py &lt;new_version&gt; [message]")
        sys.exit(1)

    new_version = sys.argv[1]
    message = sys.argv[2] if len(sys.argv) &gt; 2 else None

    create_version_tag(new_version, message)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bonnes_pratiques_et_recommandations">11. Bonnes Pratiques et Recommandations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_versioning_sémantique">11.1. Versioning Sémantique</h3>
<div class="paragraph">
<p>Utilisez le versioning sémantique (SemVer) :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MAJOR.MINOR.PATCH</code> (ex: 1.2.3)</p>
</li>
<li>
<p><code>MAJOR</code> : changements incompatibles</p>
</li>
<li>
<p><code>MINOR</code> : nouvelles fonctionnalités compatibles</p>
</li>
<li>
<p><code>PATCH</code> : corrections de bugs compatibles</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_stratégie_de_branching">11.2. Stratégie de Branching</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">main          ──●──●──●──●──●────●── (releases stables)
               /       /          /
develop    ──●──●──●──●──●──●──●──●── (développement)
            /     /        /
feature/xxx  ●──●──●──●──●──/ (fonctionnalités)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_et_couverture">11.3. Tests et Couverture</h3>
<div class="ulist">
<ul>
<li>
<p>Couverture de code minimum : 85%</p>
</li>
<li>
<p>Tests unitaires pour la logique métier</p>
</li>
<li>
<p>Tests d&#8217;intégration pour les adapters</p>
</li>
<li>
<p>Tests de bout en bout pour les CLI</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sécurité">11.4. Sécurité</h3>
<div class="ulist">
<ul>
<li>
<p>Scan automatique des dépendances (Safety)</p>
</li>
<li>
<p>Analyse statique du code (Bandit)</p>
</li>
<li>
<p>Secrets jamais dans le code</p>
</li>
<li>
<p>Utilisation de tokens PyPI spécifiques</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring_et_observabilité">12. Monitoring et Observabilité</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_métriques_de_pipeline">12.1. Métriques de Pipeline</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"># .github/workflows/metrics.yml
name: Pipeline Metrics

on:
  workflow_run:
    workflows: ["CI", "Release"]
    types: [completed]

jobs:
  metrics:
    runs-on: ubuntu-latest
    steps:
    - name: Collect metrics
      run: |
        echo "Pipeline: ${{ github.event.workflow_run.name }}"
        echo "Status: ${{ github.event.workflow_run.conclusion }}"
        echo "Duration: ${{ github.event.workflow_run.updated_at - github.event.workflow_run.created_at }}"
        # Envoyer vers système de monitoring</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_notifications">12.2. Notifications</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"># Ajout dans les workflows pour notifications
- name: Notify on failure
  if: failure()
  uses: 8398a7/action-slack@v3
  with:
    status: failure
    text: "❌ Pipeline failed for ${{ github.repository }}"
  env:
    SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">13. Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ce pipeline CI/CD complet pour Python offre :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Automatisation complète</strong> : de la validation du code à la publication</p>
</li>
<li>
<p><strong>Sécurité</strong> : scans automatiques et gestion sécurisée des secrets</p>
</li>
<li>
<p><strong>Qualité</strong> : tests multi-versions, linting et couverture de code</p>
</li>
<li>
<p><strong>Fiabilité</strong> : déploiement progressif via Test PyPI</p>
</li>
<li>
<p><strong>Traçabilité</strong> : artifacts, rapports et releases GitHub</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>L&#8217;adoption de ces pratiques garantit un processus de livraison robuste et professionnel pour vos applications Python CLI, facilitant la maintenance et l&#8217;évolution de vos projets sur le long terme.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ressources_complémentaires">14. Ressources Complémentaires</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://packaging.python.org/">Python Packaging User Guide</a></p>
</li>
<li>
<p><a href="https://docs.github.com/en/actions">GitHub Actions Documentation</a></p>
</li>
<li>
<p><a href="https://pypi.org/help/">PyPI Help Documentation</a></p>
</li>
<li>
<p><a href="https://semver.org/">Semantic Versioning Specification</a></p>
</li>
<li>
<p><a href="https://keepachangelog.com/">Keep a Changelog</a></p>
</li>
</ul>
</div>
</div>
</div></div>

            <!-- Section Commentaires Disqus -->
            <section id="disqus_thread" class="mt-5"></section>
            <script>
                /*<![CDATA[*/
                var disqus_identifier = "blog\/2025\/0086_pypi_cicd_part_2_post.html";

                (({disqus_shortname, document}) => {
                    injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
                    injectScript('//' + disqus_shortname + '.disqus.com/count.js');

                    function injectScript(url) {
                        const s = document.createElement('script');
                        s.async = true;
                        s.src = url;
                        (document.head || document.body).appendChild(s);
                    }
                })({'disqus_shortname': 'cheroliv', 'document': document});
                /*]]>*/
            </script>
            <noscript>
                <div class="alert alert-warning">
                    Veuillez activer JavaScript pour voir les
                    <a href="https://disqus.com/?ref_noscript" class="alert-link">commentaires propulsés par Disqus</a>.
                </div>
            </noscript>

        </article>
    </main>
</div>

<div>
    <!-- Footer -->
    <footer class="bg-light-theme py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p>&copy; 2018-<span>2025</span> Cheroliv. Tous droits
                        réservés.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <a href="https://github.com/cheroliv" target="_blank" class="me-3" aria-label="Profil GitHub" data-bs-toggle="tooltip" data-bs-placement="top" title="github/cheroliv"><i class="fa-brands fa-github fa-lg"></i></a>
                    <a href="../../feed.xml" aria-label="Flux RSS" data-bs-toggle="tooltip" data-bs-placement="top" title="flux RSS"><i class="fa-solid fa-rss fa-lg"></i></a>
                </div>
            </div>
        </div>
    </footer>
    <!-- Bootstrap 5.3 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Supabase Credentials Injection -->
    <script>
        /*<![CDATA[*/
        const SUPABASE_URL = null;
        const SUPABASE_KEY = null;
        /*]]>*/
    </script>
    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/go.min.js"></script>
    <script>hljs.highlightAll();</script>
    <!-- intl-tel-input JS -->
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@25.10.1/build/js/intlTelInput.min.js"></script>
    <!-- Custom JS -->
    <script src="../../js/script.js"></script>
    <script src="../../js/contact.js"></script>
</div>
</body>
</html>
